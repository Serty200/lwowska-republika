<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Nasz Paint</title>
<style>
body{margin:0;font-family:Arial;background:#2b2b2b;color:#fff}
#toolbar{display:flex;flex-wrap:wrap;gap:6px;padding:8px;background:#1e1e1e}
#toolbar>*{padding:4px}
canvas{background:#fff;cursor:crosshair;display:block;margin:0 auto}
input,select,button{background:#333;color:#fff;border:1px solid #555}
button{cursor:pointer}
#textInput{position:absolute;display:none;border:1px dashed #000;outline:none}
</style>
</head>
<body>

<div id="toolbar">
<select id="tool">
  <option value="brush">Pędzel</option>
  <option value="eraser">Gumka</option>
  <option value="line">Linia</option>
  <option value="rect">Prostokąt</option>
  <option value="circle">Koło</option>
  <option value="text">Tekst</option>
</select>

<input type="color" id="color" value="#000000">
<input type="color" id="color2" value="#ff0000">
<label><input type="checkbox" id="gradient"> Gradient</label>

<input type="number" id="size" value="5" min="1" max="100">

<select id="font">
<option>Arial</option>
<option>Verdana</option>
<option>Times New Roman</option>
<option>Courier New</option>
<option>Comic Sans MS</option>
<option>Impact</option>
<option>Georgia</option>
<option>Tahoma</option>
<option>Trebuchet MS</option>
<option>Lucida Console</option>
<option>monospace</option>
<option>serif</option>
<option>sans-serif</option>
</select>

<input type="number" id="fontSize" value="24" min="8" max="200">
<label><input type="checkbox" id="gradientText"> Gradient tekstu</label>

<button onclick="undo()">Undo</button>
<button onclick="redo()">Redo</button>
<button onclick="saveImg()">Zapisz</button>
</div>

<canvas id="canvas" width="1200" height="700"></canvas>
<input id="textInput">

<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const tool=document.getElementById('tool');
const color=document.getElementById('color');
const color2=document.getElementById('color2');
const size=document.getElementById('size');
const gradient=document.getElementById('gradient');
const font=document.getElementById('font');
const fontSize=document.getElementById('fontSize');
const gradientText=document.getElementById('gradientText');
const textInput=document.getElementById('textInput');

let drawing=false,startX=0,startY=0;
let history=[],redoStack=[];

function saveState(){history.push(canvas.toDataURL());redoStack=[];}
saveState();

canvas.onmousedown=e=>{
 drawing=true;
 startX=e.offsetX;startY=e.offsetY;
 if(tool.value==='text') startText(e.offsetX,e.offsetY);
};

canvas.onmouseup=e=>{
 if(!drawing)return;
 drawing=false;
 if(['line','rect','circle'].includes(tool.value)) drawShape(e.offsetX,e.offsetY);
 saveState();
};

canvas.onmousemove=e=>{
 if(!drawing)return;
 if(tool.value==='brush'||tool.value==='eraser') drawBrush(e.offsetX,e.offsetY);
};

function drawBrush(x,y){
 ctx.lineWidth=size.value;
 ctx.lineCap='round';
 ctx.beginPath();
 ctx.moveTo(startX,startY);
 ctx.lineTo(x,y);

 if(tool.value==='eraser'){
  ctx.globalCompositeOperation='destination-out';
  ctx.strokeStyle='rgba(0,0,0,1)';
 }else{
  ctx.globalCompositeOperation='source-over';
  if(gradient.checked){
   let g=ctx.createLinearGradient(startX,startY,x,y);
   g.addColorStop(0,color.value);
   g.addColorStop(1,color2.value);
   ctx.strokeStyle=g;
  }else ctx.strokeStyle=color.value;
 }
 ctx.stroke();
 startX=x;startY=y;
}

function drawShape(x,y){
 ctx.lineWidth=size.value;
 ctx.strokeStyle=color.value;
 ctx.beginPath();
 if(tool.value==='line'){
  ctx.moveTo(startX,startY);ctx.lineTo(x,y);
 }
 if(tool.value==='rect') ctx.rect(startX,startY,x-startX,y-startY);
 if(tool.value==='circle'){
  let r=Math.hypot(x-startX,y-startY);
  ctx.arc(startX,startY,r,0,Math.PI*2);
 }
 ctx.stroke();
}

function startText(x,y){
 textInput.style.display='block';
 textInput.style.left=x+'px';
 textInput.style.top=y+'px';
 textInput.value='';
 textInput.focus();
 textInput.onkeydown=e=>{
  if(e.key==='Enter'){
   ctx.font=`${fontSize.value}px ${font.value}`;
   let txt=textInput.value;
   if(gradientText.checked){
    let w=ctx.measureText(txt).width;
    let g=ctx.createLinearGradient(x,y,x+w,y);
    g.addColorStop(0,color.value);
    g.addColorStop(1,color2.value);
    ctx.fillStyle=g;
   }else ctx.fillStyle=color.value;
   ctx.fillText(txt,x,y);
   textInput.style.display='none';
   saveState();
  }
 };
}

function undo(){
 if(history.length>1){redoStack.push(history.pop());load(history.at(-1));}
}
function redo(){
 if(redoStack.length){let s=redoStack.pop();history.push(s);load(s);}
}
function load(src){let i=new Image();i.onload=()=>{ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(i,0,0)};i.src=src}
function saveImg(){let a=document.createElement('a');a.href=canvas.toDataURL('image/png');a.download='paint.png';a.click()}
</script>
</body>
</html>

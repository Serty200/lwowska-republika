<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Paint Pro</title>
<style>
body {
    margin: 0;
    background: #2b2b2b;
    color: #eee;
    font-family: system-ui;
}
#topbar {
    background: #1f1f1f;
    padding: 6px;
    display: flex;
    gap: 6px;
    align-items: center;
}
button, select, input {
    background: #3a3a3a;
    color: #eee;
    border: none;
    padding: 6px;
}
button:hover { background: #555 }
#workspace {
    display: flex;
    height: calc(100vh - 40px);
}
#files {
    width: 200px;
    background: #1a1a1a;
    padding: 6px;
    overflow-y: auto;
}
.file {
    padding: 6px;
    cursor: pointer;
}
.file.active {
    background: #444;
}
#canvasWrap {
    flex: 1;
    background: #777;
    overflow: auto;
}
canvas {
    background: white;
    display: block;
    margin: 20px;
}
</style>
</head>
<body>

<div id="topbar">
    <button onclick="newFile()">Nowy</button>
    <button onclick="openImage()">Otwórz</button>
    <button onclick="saveFile()">Zapisz</button>

    <select id="tool">
        <option value="brush">Pędzel</option>
        <option value="line">Linia</option>
        <option value="rect">Prostokąt</option>
        <option value="circle">Koło</option>
        <option value="triangle">Trójkąt</option>
        <option value="select">Zaznacz</option>
        <option value="gradient">Gradient</option>
        <option value="text">Tekst</option>
        <option value="ai">AI poprawa</option>
    </select>

    <input type="color" id="color1" value="#000000">
    <input type="range" id="size" min="1" max="50" value="5">
    <button onclick="zoom(1.2)">+</button>
    <button onclick="zoom(0.8)">−</button>
</div>

<div id="workspace">
    <div id="files"></div>
    <div id="canvasWrap"></div>
</div>

<input type="file" id="fileInput" hidden>

<script>
let files = [];
let current = null;
let scale = 1;

function newFile() {
    const id = Date.now();
    const canvas = document.createElement("canvas");
    canvas.width = 1200;
    canvas.height = 800;
    const ctx = canvas.getContext("2d");
    ctx.fillStyle = "white";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    files.push({ id, name: "Plik " + files.length, canvas, ctx });
    selectFile(id);
    renderFiles();
}

function renderFiles() {
    const f = document.getElementById("files");
    f.innerHTML = "";
    files.forEach(file => {
        const d = document.createElement("div");
        d.className = "file" + (file.id === current?.id ? " active":"");
        d.textContent = file.name;
        d.onclick = () => selectFile(file.id);
        f.appendChild(d);
    });
}

function selectFile(id) {
    current = files.find(f=>f.id===id);
    const wrap = document.getElementById("canvasWrap");
    wrap.innerHTML = "";
    wrap.appendChild(current.canvas);
    current.canvas.style.transform = `scale(${scale})`;
    renderFiles();
}

function saveFile() {
    const a = document.createElement("a");
    a.download = "paint.png";
    a.href = current.canvas.toDataURL();
    a.click();
}

function openImage() {
    const i = document.getElementById("fileInput");
    i.onchange = e => {
        const img = new Image();
        img.onload = () => {
            const c = document.createElement("canvas");
            c.width = img.width;
            c.height = img.height;
            c.getContext("2d").drawImage(img,0,0);
            files.push({ id: Date.now(), name: e.target.files[0].name, canvas: c, ctx: c.getContext("2d") });
            selectFile(files.at(-1).id);
        };
        img.src = URL.createObjectURL(e.target.files[0]);
    };
    i.click();
}

function zoom(v) {
    scale *= v;
    current.canvas.style.transform = `scale(${scale})`;
}

let drawing=false, sx, sy;

document.addEventListener("mousedown", e=>{
    if(!current || e.target!==current.canvas) return;
    drawing=true;
    sx=e.offsetX;
    sy=e.offsetY;
});

document.addEventListener("mouseup", e=>{
    if(!drawing || !current) return;
    drawing=false;
    const ctx=current.ctx;
    const tool=document.getElementById("tool").value;
    ctx.strokeStyle=document.getElementById("color1").value;
    ctx.lineWidth=document.getElementById("size").value;

    let x=e.offsetX, y=e.offsetY;

    if(tool==="line"){ ctx.beginPath(); ctx.moveTo(sx,sy); ctx.lineTo(x,y); ctx.stroke(); }
    if(tool==="rect"){ ctx.strokeRect(sx,sy,x-sx,y-sy); }
    if(tool==="circle"){
        let r=Math.hypot(x-sx,y-sy);
        ctx.beginPath(); ctx.arc(sx,sy,r,0,Math.PI*2); ctx.stroke();
    }
    if(tool==="triangle"){
        ctx.beginPath();
        ctx.moveTo(sx,sy);
        ctx.lineTo(x,y);
        ctx.lineTo(sx,y);
        ctx.closePath();
        ctx.stroke();
    }
    if(tool==="gradient"){
        let g=ctx.createLinearGradient(sx,sy,x,y);
        g.addColorStop(0,"white");
        g.addColorStop(1,ctx.strokeStyle);
        ctx.fillStyle=g;
        ctx.fillRect(0,0,current.canvas.width,current.canvas.height);
    }
    if(tool==="text"){
        let t=prompt("Tekst:");
        if(t){
            ctx.font="30px Arial";
            ctx.fillText(t,x,y);
        }
    }
    if(tool==="ai"){
        let img=ctx.getImageData(0,0,current.canvas.width,current.canvas.height);
        for(let i=0;i<img.data.length;i+=4){
            img.data[i]=Math.min(255,img.data[i]*1.1);
            img.data[i+1]=Math.min(255,img.data[i+1]*1.1);
            img.data[i+2]=Math.min(255,img.data[i+2]*1.1);
        }
        ctx.putImageData(img,0,0);
    }
});

document.addEventListener("mousemove", e=>{
    if(!drawing||!current) return;
    if(document.getElementById("tool").value==="brush"){
        const ctx=current.ctx;
        ctx.strokeStyle=document.getElementById("color1").value;
        ctx.lineWidth=document.getElementById("size").value;
        ctx.lineCap="round";
        ctx.beginPath();
        ctx.moveTo(sx,sy);
        ctx.lineTo(e.offsetX,e.offsetY);
        ctx.stroke();
        sx=e.offsetX; sy=e.offsetY;
    }
});

newFile();
</script>

</body>
</html>
